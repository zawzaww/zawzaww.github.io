<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Building a Kubernetes Helm Chart from Scratch" /><meta property="og:locale" content="en_US" /><meta name="description" content="In this blog post, I will share about writing Kubernetes Helm chart, YAML-based Helm template language, Helm chart development tips and focus on how to write a simple Helm Chart step by step for an application to deploy on Kubernetes and how to debug Helm templates locally. I will also demostrate with simple containerized Python Flask application to write Helm Chart and deploy it on Kubernetes cluster." /><meta property="og:description" content="In this blog post, I will share about writing Kubernetes Helm chart, YAML-based Helm template language, Helm chart development tips and focus on how to write a simple Helm Chart step by step for an application to deploy on Kubernetes and how to debug Helm templates locally. I will also demostrate with simple containerized Python Flask application to write Helm Chart and deploy it on Kubernetes cluster." /><link rel="canonical" href="https://zawzaw.blog/posts/write-k8s-helm-chart/" /><meta property="og:url" content="https://zawzaw.blog/posts/write-k8s-helm-chart/" /><meta property="og:site_name" content="Zaw Zaw" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-14T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Building a Kubernetes Helm Chart from Scratch" /><meta name="twitter:site" content="@zawzaw_me" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-31T07:42:38+00:00","datePublished":"2022-02-14T00:00:00+00:00","description":"In this blog post, I will share about writing Kubernetes Helm chart, YAML-based Helm template language, Helm chart development tips and focus on how to write a simple Helm Chart step by step for an application to deploy on Kubernetes and how to debug Helm templates locally. I will also demostrate with simple containerized Python Flask application to write Helm Chart and deploy it on Kubernetes cluster.","headline":"Building a Kubernetes Helm Chart from Scratch","mainEntityOfPage":{"@type":"WebPage","@id":"https://zawzaw.blog/posts/write-k8s-helm-chart/"},"url":"https://zawzaw.blog/posts/write-k8s-helm-chart/"}</script><title> Building a Kubernetes Helm Chart from Scratch | Zaw Zaw</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/images/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/images/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Zaw Zaw"><meta name="application-name" content="Zaw Zaw"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/images/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/favicons/favicon-16x16.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Zaw Zaw</a></div><div class="site-subtitle font-italic">ZAW's Library & Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/photography/" class="nav-link"> <i class="fa-fw fas fa-image ml-xl-3 mr-xl-3 unloaded"></i> <span>PHOTOGRAPHY</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fas fa-phone ml-xl-3 mr-xl-3 unloaded"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zawzaww" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://x.com/zawzaw_me" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-x-twitter"></i> </a> <a href="https://www.linkedin.com/in/zawzaww" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/zawzaw.me" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['zawzthein','outlook.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Building a Kubernetes Helm Chart from Scratch</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Building a Kubernetes Helm Chart from Scratch</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Building a Kubernetes Helm Chart from Scratch</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Zaw Zaw </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Feb 14, 2022, 12:00 AM +0000" prep="on" > Feb 14, 2022 <i class="unloaded">2022-02-14T00:00:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Tue, Dec 31, 2024, 3:42 PM +0800" prefix="Updated " > Dec 31, 2024 <i class="unloaded">2024-12-31T07:42:38+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2265 words">12 min</span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/featured-images/img_helm_kubernetes.png" class="preview-img" alt="Preview Image"><p align="center"> <span class="caption" style="font-size: 14px; font-weight: 500; font-style: oblique;"> Helm Official Logo by Helm Community </span></p><p>In this blog post, I will share about writing Kubernetes Helm chart, YAML-based Helm template language, Helm chart development tips and focus on how to write a simple Helm Chart step by step for an application to deploy on Kubernetes and how to debug Helm templates locally. I will also demostrate with simple containerized Python Flask application to write Helm Chart and deploy it on Kubernetes cluster.</p><h2 id="prerequisites">Prerequisites</h2><ul><li><a href="https://kubernetes.io">Kubernetes</a> cluster<li><a href="https://helm.sh">Helm</a> Kubernetes package manager tool<li>Kubernetes Basics<blockquote><p>You need to understand basic <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/kubernetes-objects">Kubernetes objects</a> and <a href="https://kubernetes.io/docs/concepts/workloads">Workloads resources</a>. If you are not fimiliar with Kubernetes, you can learn basics with <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics">Kubernetes Basics</a> interactive tutorial.</p></blockquote></ul><h2 id="introduction-to-helm">Introduction to Helm</h2><p>Basically, <a href="https://helm.sh">Helm</a> is a Kubernetes package manager that manages and deploys Helm charts.</p><p><a href="https://artifacthub.io">Helm Charts</a> are collection and packages of pre-configured application ressources which can be deployed as one unit on Kubernetes. Helm charts help you <strong>define</strong>, <strong>install</strong>, <strong>upgrade</strong>, <strong>rollback</strong> and <strong>deploy</strong> applications easily on Kubernetes cluster.</p><p>Official Website: <a href="https://helm.sh">https://helm.sh</a></p><h2 id="setup-local-kubernetes-cluster">Setup Local Kubernetes Cluster</h2><p>In this article, I will use <a href="https://minikube.sigs.k8s.io/docs">minikube</a> for setup local Kubernetes cluster on my Fedora Linux system. You can use any other tools for setup Kubernetes cluster.</p><p>Download minikube CLI tool, it depends on your Operating System.</p><p>Please, see <a href="https://minikube.sigs.k8s.io/docs/start">https://minikube.sigs.k8s.io/docs/start</a></p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>curl <span class="nt">-LO</span> https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
</pre></table></code></div></div><p>Install minikube:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">sudo install </span>minikube-linux-amd64 /usr/local/bin/minikube
</pre></table></code></div></div><p>Start local minikube Kubernetes cluster with containerd:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>minikube start <span class="nt">--container-runtime</span><span class="o">=</span>containerd
</pre></table></code></div></div><p>Check minikube status:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">[</span>zawzaw@redhat-linux:~]<span class="nv">$ </span>minikube status
minikube
<span class="nb">type</span>: Control Plane
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured
</pre></table></code></div></div><h2 id="installation-helm">Installation Helm</h2><p>To install Helm with script, run simply like this:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>curl <span class="nt">-fsSL</span> <span class="nt">-o</span> get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">chmod</span> +x get_helm.sh <span class="o">&amp;&amp;</span> ./get_helm.sh
</pre></table></code></div></div><p>(OR)</p><p>You can install Helm via package manager tools:</p><ul><li><a href="https://download.lineageos.org">https://helm.sh/docs/intro/install/#from-apt-debianubuntu</a><li><a href="https://helm.sh/docs/intro/install/#from-snap">https://helm.sh/docs/intro/install/#from-snap</a></ul><h2 id="containerize-an-application">Containerize an application</h2><p>Before we write Kubernetes Helm chart, we need to containerize for your web application.</p><p>In this article, I will use open sourced pod-info-app: <a href="https://gitlab.com/gitops-argocd-demo/webapp">https://gitlab.com/gitops-argocd-demo/webapp</a> simple Python Flask application to demonstrate writing Helm chart and deploy it on Kubernetes cluster.</p><p>Download <code class="language-plaintext highlighter-rouge">pod-info-app</code> Git repository:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>git clone https://gitlab.com/gitops-argocd-demo/webapp.git pod-info-app
</pre></table></code></div></div><p>This app application author has already written <code class="language-plaintext highlighter-rouge">Dockerfile</code> but we can update and customize <code class="language-plaintext highlighter-rouge">Dockerfile</code> to update Python version and run gunicorn server with specific app user, instead of running container as root user.</p><p>Update port number in <code class="language-plaintext highlighter-rouge">PROJECT_ROOT/gunicorn-cfg.py</code> file like this:</p><div class="language-py highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1"># -*- encoding: utf-8 -*-
</span><span class="n">bind</span> <span class="o">=</span> <span class="sh">'</span><span class="s">0.0.0.0:8080</span><span class="sh">'</span>
<span class="n">workers</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">accesslog</span> <span class="o">=</span> <span class="sh">'</span><span class="s">-</span><span class="sh">'</span>
<span class="n">loglevel</span> <span class="o">=</span> <span class="sh">'</span><span class="s">debug</span><span class="sh">'</span>
<span class="n">capture_output</span> <span class="o">=</span> <span class="bp">True</span>
</pre></table></code></div></div><p>Update and customize <code class="language-plaintext highlighter-rouge">PROJECT_ROOT/Dockefile</code> file to run container with specific app user:</p><div class="language-Dockerfile highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> python:3.8-slim</span>

<span class="k">ENV</span><span class="s"> FLASK_APP run.py</span>
<span class="k">ENV</span><span class="s"> APP_WORKDIR=/app</span>
<span class="k">ENV</span><span class="s"> APP_USER=zawzaw</span>
<span class="k">ENV</span><span class="s"> APP_PORT=8080</span>

<span class="k">RUN </span>python <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">--upgrade</span> pip

<span class="k">RUN </span>useradd <span class="nt">--create-home</span> <span class="k">${</span><span class="nv">APP_USER</span><span class="k">}</span>

<span class="k">WORKDIR</span><span class="s"> ${APP_WORKDIR}</span>

<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">RUN </span><span class="nb">chown</span> <span class="k">${</span><span class="nv">APP_USER</span><span class="k">}</span>:<span class="k">${</span><span class="nv">APP_USER</span><span class="k">}</span> <span class="nt">-R</span> <span class="k">${</span><span class="nv">APP_WORKDIR</span><span class="k">}</span>

<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt

<span class="k">USER</span><span class="s"> ${APP_USER}</span>

<span class="k">EXPOSE</span><span class="s"> ${APP_PORT}</span>

<span class="k">ENTRYPOINT</span><span class="s"> ["gunicorn", "--config", "gunicorn-cfg.py", "run:app"]</span>
</pre></table></code></div></div><p>Dockerfile is very simple:</p><ul><li>Install required Python packages with pip.<li>Serve Python Flask app with gunicorn server.</ul><p>Build Docker container image locally:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>docker build <span class="nt">-t</span> pod-info-app <span class="nb">.</span>
</pre></table></code></div></div><p>Run pod-info-app locally with Docker run:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>docker run <span class="nt">-p</span> 8080:8080 <span class="nt">-it</span> <span class="nt">--rm</span> pod-info-app:latest
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>...
<span class="o">[</span>2022-02-13 08:41:04 +0000] <span class="o">[</span>1] <span class="o">[</span>INFO] Starting gunicorn 20.0.4
<span class="o">[</span>2022-02-13 08:41:04 +0000] <span class="o">[</span>1] <span class="o">[</span>DEBUG] Arbiter booted
<span class="o">[</span>2022-02-13 08:41:04 +0000] <span class="o">[</span>1] <span class="o">[</span>INFO] Listening at: http://0.0.0.0:8080 <span class="o">(</span>1<span class="o">)</span>
<span class="o">[</span>2022-02-13 08:41:04 +0000] <span class="o">[</span>1] <span class="o">[</span>INFO] Using worker: <span class="nb">sync</span>
<span class="o">[</span>2022-02-13 08:41:04 +0000] <span class="o">[</span>9] <span class="o">[</span>INFO] Booting worker with pid: 9
<span class="o">[</span>2022-02-13 08:41:04 +0000] <span class="o">[</span>1] <span class="o">[</span>DEBUG] 1 workers
</pre></table></code></div></div><p>Test application locally:</p><ul><li><a href="http://0.0.0.0:8080">http://0.0.0.0:8080</a></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/screenshots/img_screenshot_pod_info_app.png" alt="Screenshot" /></p><p>Final step, Build and Push Docker container image into your Docker Registry.</p><p>For example: My Docker Hub username is <code class="language-plaintext highlighter-rouge">zawzaww</code>. It depends on your Docker Hub user name.</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>docker build <span class="nt">-t</span> zawzaww/pod-info-app <span class="nb">.</span>
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>docker push zawzaww/pod-info-app:latest
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>The push refers to repository <span class="o">[</span>docker.io/zawzaww/pod-info-app]
687ccfae7d0e: Pushed
779e7681e9a7: Pushed
f57ce0722888: Pushed
34decbbd20d2: Pushed
314e501bfdc5: Pushed
9c81064245d9: Pushed
87ea2744abf2: Mounted from library/python
51f094ff7b94: Mounted from library/python
1a40cb2669f8: Mounted from library/python
32034715e5d4: Mounted from library/python
7d0ebbe3f5d2: Mounted from library/python
latest: digest: sha256:2f584b970b2bb5d9db9ece9d36cf8426ad7b9c4fc0dc1e059c6d1c02805c2395 size: 2629
</pre></table></code></div></div><h2 id="create-and-write-a-helm-chart">Create and Write a Helm Chart</h2><h3 id="understanding-application-concepts">Understanding application concepts</h3><p>Before we write a Helm chart for our application, we firstly need to understand how our application has designed, how our application works and so on.</p><p>This <a href="https://gitlab.com/gitops-argocd-demo/webapp">pod-info</a> is a very simple web application written in Python with Flask.</p><p>In pod-info application, we will display the following information in Web UI:</p><ul><li>Namespace<li>Node Name<li>Pod Name<li>Pop IP</ul><p>For Example:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/screenshots/img_screenshot_pod_info_data.png" alt="Screenshot" class="normal" /></p><p>Basically, pod-info application gets information dynamically through the Kubernetes environment variables. So, we need to expose pod information to container through the environment variables in Kubernetes. Then, app uses this environment variables to get information dynamically.</p><p>Ref: <a href="https://kubernetes.io/docs/tasks/inject-data-application/environment-variable-expose-pod-information">Expose Pod Information to Containers Through Environment Variables</a></p><p>For example, we can set this <code class="language-plaintext highlighter-rouge">ENV</code> variables with key/value form in Kubernetes deployment like this:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="na">env</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NODE_NAME</span>
    <span class="na">valueFrom</span><span class="pi">:</span>
      <span class="na">fieldRef</span><span class="pi">:</span>
        <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">spec.nodeName</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NAMESPACE</span>
    <span class="na">valueFrom</span><span class="pi">:</span>
      <span class="na">fieldRef</span><span class="pi">:</span>
        <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.namespace</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAME</span>
    <span class="na">valueFrom</span><span class="pi">:</span>
      <span class="na">fieldRef</span><span class="pi">:</span>
        <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.name</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_IP</span>
    <span class="na">valueFrom</span><span class="pi">:</span>
      <span class="na">fieldRef</span><span class="pi">:</span>
        <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">status.podIP</span>
</pre></table></code></div></div><p>It’s like key value form:</p><ul><li><code class="language-plaintext highlighter-rouge">NODE_NAME</code>=<code class="language-plaintext highlighter-rouge">spec.nodeName</code><li><code class="language-plaintext highlighter-rouge">NAMESPCE</code>=<code class="language-plaintext highlighter-rouge">metadata.namespace</code><li><code class="language-plaintext highlighter-rouge">POD_NAME</code>=<code class="language-plaintext highlighter-rouge">metadata.name</code><li><code class="language-plaintext highlighter-rouge">POD_IP</code>=<code class="language-plaintext highlighter-rouge">status.podIP</code></ul><h3 id="initialize-a-helm-chart-with-helm-cli">Initialize a Helm Chart with Helm CLI</h3><p>Before you start, make sure you understand <strong>Kubernete Objects</strong> and <strong>Workloads Resources</strong> first. If you are not fimiliar with Kubernetes, you can learn from <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics">Kubernetes Basics</a> tutorial.</p><p>After we understand pod-info-app’s concept, let’s create a Helm chart with Helm CLI tool.</p><p>Initialize a Helm chart:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nv">$ </span>helm create pod-info
Creating pod-info
</pre></table></code></div></div><p>Then, Helm automatically generates required Helm templates and values like this:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="o">[</span>zawzaw@redhat-linux:~/helm/helm-charts/pod-info]<span class="nv">$ </span>tree
<span class="nb">.</span>
├── Chart.yaml
├── templates
│   ├── deployment.yaml
│   ├── _helpers.tpl
│   ├── hpa.yaml
│   ├── ingress.yaml
│   ├── NOTES.txt
│   ├── serviceaccount.yaml
│   ├── service.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml

2 directories, 10 files
</pre></table></code></div></div><h3 id="writing-and-customizing-helm-chart">Writing and Customizing Helm Chart</h3><p>Basically, Helm Charts have main three categories:</p><ul><li><code class="language-plaintext highlighter-rouge">Chart.yaml</code><ul><li>Define Helm chart name, description, chart revision and so on.</ul><li><code class="language-plaintext highlighter-rouge">templates/</code><ul><li>Helm templates are general and dynamic configurations that locate Kubernetes resources written in YAML-based <a href="https://helm.sh/docs/chart_template_guide">Helm template language</a>. It means that we can pass variables from <code class="language-plaintext highlighter-rouge">values.yaml</code> file into templates files when we deploy Helm chart. So, values can be changed dynamically based on you configured Helm templates at deployment time.</ul><li><code class="language-plaintext highlighter-rouge">values.yaml</code><ul><li>Declare variables to be passed into Helm templates. So, when we run <code class="language-plaintext highlighter-rouge">helm install</code> to deploy Helm charts, Helm sets this variables into Helm templates files based on you configured templates and values.</ul></ul><p>In the other words, Helm charts are pre-configured configurations and packages as one unit to deploy applications esaily on Kubernetes cluster.</p><p>After initialize a new Helm chart, we need to customize Helm templates and values as you need. It depends on your web application. For pod-info Helm chart, we need to configure the following steps.</p><h4 id="set-docker-container-image">Set Docker container image</h4><ul><li><p>In <code class="language-plaintext highlighter-rouge">values.yaml</code> file, define variables for Docker container image that we’ve built and pushed into Docker registry.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="na">image</span><span class="pi">:</span>
  <span class="na">repository</span><span class="pi">:</span> <span class="s">zawzaww/pod-info-app</span>
  <span class="na">pullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
  <span class="na">tag</span><span class="pi">:</span> <span class="s2">"</span><span class="s">latest"</span>
</pre></table></code></div></div><li><p>In <code class="language-plaintext highlighter-rouge">templates/deployment.yaml</code> file, we can set variables from values.yaml with <code class="language-plaintext highlighter-rouge">.Values.image.repository</code>, <code class="language-plaintext highlighter-rouge">.Values.image.pullPolicay</code> and <code class="language-plaintext highlighter-rouge">.Values.image.tag</code>. It’s YAML-based Helm template language syntax. You can learn on <a href="https://helm.sh/docs/chart_template_guide">The Chart Template Developer’s Guide</a>.</p><ul><li>Get Docker image repository: <code class="language-plaintext highlighter-rouge">.Values.image.repository</code><li>Get Docker image pull policy: <code class="language-plaintext highlighter-rouge">.Values.image.pullPolicy</code><li>Get Docker image tag: <code class="language-plaintext highlighter-rouge">.Values.image.tag</code></ul></ul><p>So, when need to get variables form <code class="language-plaintext highlighter-rouge">values.yaml</code> file, we can use <code class="language-plaintext highlighter-rouge">.Values</code> in Helm templates like this:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Chart.Name</span> <span class="pi">}}</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{{</span><span class="nv"> </span><span class="s">.Values.image.repository</span><span class="nv"> </span><span class="s">}}:{{</span><span class="nv"> </span><span class="s">.Values.image.tag</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default</span><span class="nv"> </span><span class="s">.Chart.AppVersion</span><span class="nv"> </span><span class="s">}}"</span>
    <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.image.pullPolicy</span> <span class="pi">}}</span>
</pre></table></code></div></div><h4 id="set-service-port-and-target-port">Set Service Port and Target Port</h4><ul><li><p>In <code class="language-plaintext highlighter-rouge">values.yaml</code> file, define variables for sevice type, port and targetPort.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="na">service</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
  <span class="na">targetPort</span><span class="pi">:</span> <span class="s">http</span>
</pre></table></code></div></div><li><p>In <code class="language-plaintext highlighter-rouge">templates/service.yaml</code> file, we can set service varibales from values.yaml file like this:</p><ul><li>Get service type: <code class="language-plaintext highlighter-rouge">.Values.service.type</code><li>Get service port: <code class="language-plaintext highlighter-rouge">.Values.service.port</code><li>Get service target port: <code class="language-plaintext highlighter-rouge">.Values.service.targetPort</code></ul></ul><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.service.type</span> <span class="pi">}}</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.service.port</span> <span class="pi">}}</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.service.targetPort</span> <span class="pi">}}</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
</pre></table></code></div></div><h4 id="set-target-docker-container-port">Set Target Docker Container Port</h4><ul><li>In <code class="language-plaintext highlighter-rouge">values.yaml</code> file, define variable for container port that exposes <code class="language-plaintext highlighter-rouge">8080</code> in our pod-info-app’s Docker container.</ul><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="na">deployment</span><span class="pi">:</span>
  <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
</pre></table></code></div></div><ul><li>In <code class="language-plaintext highlighter-rouge">templates/deployment.yaml</code> file, set target Docker container port variable from values.yaml file:<ul><li>Get target container port: <code class="language-plaintext highlighter-rouge">.Values.deployment.containerPort</code></ul></ul><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="na">containers</span><span class="pi">:</span>
 <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Chart.Name</span> <span class="pi">}}</span>
   <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
      <span class="na">containerPort</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Values.deployment.containerPort</span> <span class="pi">}}</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
</pre></table></code></div></div><h4 id="set-environment-varibales">Set Environment Varibales</h4><ul><li>In <code class="language-plaintext highlighter-rouge">values.yaml</code> file, define environment variables that our pod-info application use to get information data in Web UI.</ul><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="na">deployment</span><span class="pi">:</span>
  <span class="na">env</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NODE_NAME</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">spec.nodeName</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NAMESPACE</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.namespace</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAME</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.name</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_IP</span>
      <span class="na">valueFrom</span><span class="pi">:</span>
        <span class="na">fieldRef</span><span class="pi">:</span>
          <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">status.podIP</span>
</pre></table></code></div></div><ul><li>In <code class="language-plaintext highlighter-rouge">templates/deployment.yaml</code>, set environment variables dynamically from values.yaml file.<ul><li>So, when you need to pass the array and whole config block into Helm templates, you can use <code class="language-plaintext highlighter-rouge">- with</code> and <code class="language-plaintext highlighter-rouge">- toYaml</code>.</ul></ul><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="pi">{{</span> <span class="nv">.Chart.Name</span> <span class="pi">}}</span>
    <span class="pi">{{</span><span class="nv">- with .Values.deployment.env</span> <span class="pi">}}</span>
     <span class="na">env</span><span class="pi">:</span>
       <span class="pi">{{</span><span class="nv">- toYaml . | nindent 12</span> <span class="pi">}}</span>
    <span class="pi">{{</span><span class="nv">- end</span> <span class="pi">}}</span>
</pre></table></code></div></div><h2 id="debugging-the-helm-templates">Debugging the Helm Templates</h2><p>After we write Helm chart for pod-info application, we can debug and test Helm templates with <code class="language-plaintext highlighter-rouge">helm template</code> command. So, <code class="language-plaintext highlighter-rouge">helm template</code> CLI shows passed real values into templates.</p><p>Format:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>helm template &lt;chart_name&gt; &lt;dir_path&gt; <span class="nt">--values</span> &lt;values_file_path&gt;
</pre></table></code></div></div><p>For Example:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>helm template pod-info-dev pod-info <span class="nt">--values</span> pod-info/values.yaml
</pre></table></code></div></div><p>If you have syntax errors, Helm shows error messages.</p><p>This is automatically generated by Helm Template CLI based on you configured Helm templates and values.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
</pre><td class="rouge-code"><pre><span class="nn">---</span>
<span class="c1"># Source: pod-info/templates/serviceaccount.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">pod-info-0.1.0</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">pod-info</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1.16.0"</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
<span class="nn">---</span>
<span class="c1"># Source: pod-info/templates/service.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">pod-info-0.1.0</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">pod-info</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1.16.0"</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="s">http</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">pod-info</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
<span class="nn">---</span>
<span class="c1"># Source: pod-info/templates/deployment.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">pod-info-0.1.0</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">pod-info</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1.16.0"</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">pod-info</span>
      <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">pod-info</span>
        <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
      <span class="na">securityContext</span><span class="pi">:</span>
        <span class="pi">{}</span>
      <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">pod-info</span>
          <span class="na">securityContext</span><span class="pi">:</span>
            <span class="pi">{}</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">zawzaww/pod-info-app:latest"</span>
          <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
          <span class="na">ports</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
              <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
              <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">env</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NODE_NAME</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">spec.nodeName</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">NAMESPACE</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.namespace</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_NAME</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">metadata.name</span>
            <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">POD_IP</span>
              <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">fieldRef</span><span class="pi">:</span>
                  <span class="na">fieldPath</span><span class="pi">:</span> <span class="s">status.podIP</span>
          <span class="na">livenessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">port</span><span class="pi">:</span> <span class="s">http</span>
          <span class="na">readinessProbe</span><span class="pi">:</span>
            <span class="na">httpGet</span><span class="pi">:</span>
              <span class="na">path</span><span class="pi">:</span> <span class="s">/</span>
              <span class="na">port</span><span class="pi">:</span> <span class="s">http</span>
          <span class="na">resources</span><span class="pi">:</span>
            <span class="na">limits</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">128Mi</span>
            <span class="na">requests</span><span class="pi">:</span>
              <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
              <span class="na">memory</span><span class="pi">:</span> <span class="s">128Mi</span>
<span class="nn">---</span>
<span class="c1"># Source: pod-info/templates/tests/test-connection.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">pod-info-dev-test-connection"</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">pod-info-0.1.0</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">pod-info</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1.16.0"</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="s2">"</span><span class="s">helm.sh/hook"</span><span class="err">:</span> <span class="s">test</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">wget</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">busybox</span>
      <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">wget'</span><span class="pi">]</span>
      <span class="na">args</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">pod-info-dev:80'</span><span class="pi">]</span>
  <span class="na">restartPolicy</span><span class="pi">:</span> <span class="s">Never</span>
</pre></table></code></div></div><h2 id="deploy-helm-chart-on-kubernetes-cluster">Deploy Helm Chart on Kubernetes Cluster</h2><p>We can now deploy pod-info application with Helm chart on our minikube Kubernetes cluster.</p><p>Deploy pod-info application simply like this:</p><p>Format:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>helm <span class="nb">install</span> &lt;chart_name&gt; &lt;dir_path&gt; <span class="se">\</span>
 <span class="nt">--values</span> &lt;values_file_path&gt; <span class="se">\</span>
 <span class="nt">--create-namespace</span> <span class="se">\</span>
 <span class="nt">--namespace</span> &lt;namespace&gt;
</pre></table></code></div></div><p>For example:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nv">$ </span>helm <span class="nb">install </span>pod-info-dev pod-info <span class="se">\</span>
 <span class="nt">--values</span> pod-info/values.yaml <span class="se">\</span>
 <span class="nt">--create-namespace</span> <span class="se">\</span>
 <span class="nt">--namespace</span> dev
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>NAME: pod-info-dev
LAST DEPLOYED: Mon Feb 14 01:44:09 2022
NAMESPACE: dev
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  <span class="nb">export </span><span class="nv">NODE_PORT</span><span class="o">=</span><span class="si">$(</span>kubectl get <span class="nt">--namespace</span> dev <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.spec.ports[0].nodePort}"</span> services pod-info-dev<span class="si">)</span>
  <span class="nb">export </span><span class="nv">NODE_IP</span><span class="o">=</span><span class="si">$(</span>kubectl get nodes <span class="nt">--namespace</span> dev <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.items[0].status.addresses[0].address}"</span><span class="si">)</span>
  <span class="nb">echo </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
</pre></table></code></div></div><p>We’ve setup <code class="language-plaintext highlighter-rouge">NodePort</code> service type in your pod-info Helm chart’s service configuration. So, we can access our application via <code class="language-plaintext highlighter-rouge">Node Port</code> from outside of Kubernetes cluster. Remember this:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="c1"># Source: pod-info/templates/service.yaml</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">helm.sh/chart</span><span class="pi">:</span> <span class="s">pod-info-0.1.0</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">pod-info</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
    <span class="na">app.kubernetes.io/version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1.16.0"</span>
    <span class="na">app.kubernetes.io/managed-by</span><span class="pi">:</span> <span class="s">Helm</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">NodePort</span>
  <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
      <span class="na">targetPort</span><span class="pi">:</span> <span class="s">http</span>
      <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">http</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">app.kubernetes.io/name</span><span class="pi">:</span> <span class="s">pod-info</span>
    <span class="na">app.kubernetes.io/instance</span><span class="pi">:</span> <span class="s">pod-info-dev</span>
</pre></table></code></div></div><p>So, to get and access the pod-info application in your web browser, run the following commands:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">export </span><span class="nv">NODE_PORT</span><span class="o">=</span><span class="si">$(</span>kubectl get <span class="nt">--namespace</span> dev <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.spec.ports[0].nodePort}"</span> services pod-info-dev<span class="si">)</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">NODE_IP</span><span class="o">=</span><span class="si">$(</span>kubectl get nodes <span class="nt">--namespace</span> dev <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">"{.items[0].status.addresses[0].address}"</span><span class="si">)</span>
<span class="nv">$ </span><span class="nb">echo </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_PORT</span>
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://192.168.58.2:32431
</pre></table></code></div></div><p>You can also assign this Node IP address with specific host entry in <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>192.168.58.2     pod-info-dev.local
</pre></table></code></div></div><p>Our application’s URL:</p><p><a href="http://pod-info-dev.local:32431">http://pod-info-dev.local:32431</a></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/screenshots/img_screenshot_pod_info_demo.png" alt="Screenshot" /></p><p>Now, you can see <code class="language-plaintext highlighter-rouge">Namespace</code>, <code class="language-plaintext highlighter-rouge">Node Name</code>, <code class="language-plaintext highlighter-rouge">Pod Name</code> and <code class="language-plaintext highlighter-rouge">Pod IP</code> data in pod-info Web UI application.</p><p>Credit and Thank to <a href="https://medium.com/@poom.wettayakorn">@poom.wettayakorn</a> for <a href="https://gitlab.com/gitops-argocd-demo/webapp">pod-info</a> Python Flask application.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/helm/" class="post-tag no-text-decoration" >helm</a> <a href="/tags/chart/" class="post-tag no-text-decoration" >chart</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Building a Kubernetes Helm Chart from Scratch - Zaw Zaw&url=https://zawzaw.blog/posts/write-k8s-helm-chart/" data-toggle="tooltip" data-placement="top" title="X (Twitter)" target="_blank" rel="noopener" aria-label="X (Twitter)"> <i class="fa-fw fab fa-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Building a Kubernetes Helm Chart from Scratch - Zaw Zaw&u=https://zawzaw.blog/posts/write-k8s-helm-chart/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://zawzaw.blog/posts/write-k8s-helm-chart/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2" style="font-size: large;">Table of Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Related Posts</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/automated-k3s-cluster-upgrades/"><div class="card-body"> <span class="timeago small" > Feb 25, 2024 <i class="unloaded">2024-02-25T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bootstrapping a K3s Cluster and Configuring its Automated Upgrades</h3><div class="text-muted small"><p> This article focuses on how to setup and bootstrap the multi-node K3s cluster and how to configure automated upgrading of the K3s Kubernetes cluster. This covers both how to setup a multi-node K3s ...</p></div></div></a></div><div class="card"> <a href="/posts/configure-k8s-auth-rbac/"><div class="card-body"> <span class="timeago small" > Dec 5, 2024 <i class="unloaded">2024-12-05T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Configuring RBAC Role Bindings for a User on Kubernetes</h3><div class="text-muted small"><p> This article focuses on how to create a user and configure cluster roles and role bindings for that user using Kubernetes built-in RBAC authorization features. Basically, in Kubernetes, we can use ...</p></div></div></a></div><div class="card"> <a href="/posts/guide-k8s-persistent-storage/"><div class="card-body"> <span class="timeago small" > Jan 31 <i class="unloaded">2025-01-31T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A Hands-on Practical Guide to K8s Persistent Storage</h3><div class="text-muted small"><p> In Kubernetes, we typically need to create and use Persistent Volumes for stateful applications such as database servers, cache store servers, and so on. In this article, I will share how storage p...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/compile-linux-clang-llvm/" class="btn btn-outline-primary" prompt="Older"><p>Building Linux Kernel with Clang/LLVM</p></a> <a href="/posts/polar-night-and-midnight-sun/" class="btn btn-outline-primary" prompt="Newer"><p>Exploring the Polar Night and Midnight Sun (Polar Day)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025, <a href="https://github.com/zawzaww">Zaw Zaw</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) by the author.">Licensed under CC BY 4.0.</span></p></div><div class="footer-right"><p class="mb-0"> <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">CHIRPY Theme</a> &mdash; <a href="https://jekyllrb.com" target="_blank" rel="noopener"> Powered byJekyll</a></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/aosp/">aosp</a> <a class="post-tag" href="/tags/build/">build</a> <a class="post-tag" href="/tags/containerization/">containerization</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/asia/">asia</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zawzaw.blog{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
