<!DOCTYPE html><html lang="en-US" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="A Hands-on Practical Guide to K8s Persistent Storage" /><meta property="og:locale" content="en_US" /><meta name="description" content="In Kubernetes, we typically need to create and use Persistent Volumes for stateful applications such as database servers, cache store servers, and so on. In this article, I will share how storage provisioning on Kubernetes works and how to deploy Persistent Volumes dynamically using storage provisioners on the Kubernetes cluster." /><meta property="og:description" content="In Kubernetes, we typically need to create and use Persistent Volumes for stateful applications such as database servers, cache store servers, and so on. In this article, I will share how storage provisioning on Kubernetes works and how to deploy Persistent Volumes dynamically using storage provisioners on the Kubernetes cluster." /><link rel="canonical" href="https://zawzaw.blog/posts/guide-k8s-persistent-storage/" /><meta property="og:url" content="https://zawzaw.blog/posts/guide-k8s-persistent-storage/" /><meta property="og:site_name" content="Zaw Zaw" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-01-31T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="A Hands-on Practical Guide to K8s Persistent Storage" /><meta name="twitter:site" content="@zawzaw_me" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-06-01T03:17:40+00:00","datePublished":"2025-01-31T00:00:00+00:00","description":"In Kubernetes, we typically need to create and use Persistent Volumes for stateful applications such as database servers, cache store servers, and so on. In this article, I will share how storage provisioning on Kubernetes works and how to deploy Persistent Volumes dynamically using storage provisioners on the Kubernetes cluster.","headline":"A Hands-on Practical Guide to K8s Persistent Storage","mainEntityOfPage":{"@type":"WebPage","@id":"https://zawzaw.blog/posts/guide-k8s-persistent-storage/"},"url":"https://zawzaw.blog/posts/guide-k8s-persistent-storage/"}</script><title> A Hands-on Practical Guide to K8s Persistent Storage | Zaw Zaw</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/images/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/images/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Zaw Zaw"><meta name="application-name" content="Zaw Zaw"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/images/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/images/favicons/favicon-16x16.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Zaw Zaw</a></div><div class="site-subtitle font-italic">ZAW's Library & Personal Blog</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/photography/" class="nav-link"> <i class="fa-fw fas fa-image ml-xl-3 mr-xl-3 unloaded"></i> <span>PHOTOGRAPHY</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fas fa-phone ml-xl-3 mr-xl-3 unloaded"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT ME</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/zawzaww" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://x.com/zawzaw_me" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-x-twitter"></i> </a> <a href="https://www.linkedin.com/in/zawzaww" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.instagram.com/zawzaw.me" aria-label="instagram" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['zawzthein','outlook.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>A Hands-on Practical Guide to K8s Persistent Storage</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> A Hands-on Practical Guide to K8s Persistent Storage</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>A Hands-on Practical Guide to K8s Persistent Storage</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Zaw Zaw </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 31, 2025, 12:00 AM +0000" prep="on" > Jan 31 <i class="unloaded">2025-01-31T00:00:00+00:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Jun 1, 2025, 11:17 AM +0800" prefix="Updated " > Jun 1 <i class="unloaded">2025-06-01T03:17:40+00:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3080 words">17 min</span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/featured-images/img_kubernetes_storage.png" class="preview-img" alt="Preview Image"><p align="center"> <span class="caption" style="font-size: 14px; font-weight: 500; font-style: oblique;"> Kubernetes Storage Featured Image by Zaw Zaw </span></p><p>In Kubernetes, we typically need to create and use <em>Persistent Volumes</em> for stateful applications such as database servers, cache store servers, and so on. In this article, I will share how storage provisioning on Kubernetes works and how to deploy <em>Persistent Volumes</em> dynamically using storage provisioners on the Kubernetes cluster.</p><p>In this article. I will mainly focus on configuring the <strong>Local-Path</strong> and <strong>NFS</strong> storage provisioners and managing persistent storage on the Kubernetes On-premises cluster, also known as self-managed Kubernetes.</p><h2 id="summary-objectives">Summary: Objectives</h2><p><em>What you’ll learn in this article:</em></p><ul><li><p>Basic concepts of Kubernetes persistent storage.</p><li><p>Difference between <em>Static</em> storage provisioning and <em>Dynamic</em> storage provisioning.</p><li><p>How storage provisioning on Kubernetes works.</p><li><p>How to setup <strong>Local-Path</strong> and <strong>NFS</strong> storage provisioners on Kubernetes.</p><li><p>How to create and provision <em>Persistent Volumes</em> on-demand or dynamically on Kubernetes.</p></ul><h2 id="prerequisites">Prerequisites</h2><ul><li><p><a href="https://kubernetes.io">Kubernetes</a> Cluster</p><li><p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux">kubectl</a>, a client CLI tool to communicate with the cluster</p><li><p><a href="https://helm.sh">Helm</a> package manager tool</p><li><p>Kubernetes Basics</p><blockquote><p>Make sure you are familiar with basic Kubernetes objects and resources. If you are a Kubernetes newcomer, you can learn <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics">Kubernetes Basics</a> tutorial that provides a hands-on practical guide on the basics of Kubernetes, container orchestration system.</p></blockquote></ul><h2 id="background">Background</h2><h3 id="introduction-to-kubernetes-persistent-volumes">Introduction to Kubernetes Persistent Volumes</h3><p>Firstly, we need to understand basic concepts on Kubernetes <em>Persistent Volumes</em> and how Kubernetes creates and manages persistent volumes. So, we will learn the basics before we setup and configure storage provisioners on the Kubernetes platform.</p><p>Basically, Kubernetes has the following main two API resources to manage persistent storage.</p><ul><li><em>PersistentVolume (PV)</em><li><em>PersistentVolumeClaim (PVC)</em></ul><p><strong>PersistentVolume (PV)</strong> represents a piece of storage in the Kubernetes cluster. PVs can be provisioned manually by a cluster administrator or dynamically provisioned using PersistentVolumeClaim (PVC) with a storage class, and PVs can be filesystems (physical disks) and cloud storage services such as Amazon EBS and Azure disk.</p><p><strong>PersistentVolumeClaim (PVC)</strong> represents a request for storage, such as the storage size, access mode, and storage class. Persistent Volumes can be provisioned dynamically using PVC and storage class with any storage provisioner.</p><p>It’s a simple introduction. I will explain more details on persistent volumes with examples and demonstrate how to use them in the next sections.</p><h2 id="storage-provisioning-on-kubernetes">Storage Provisioning on Kubernetes</h2><p>Basically, Kubernetes has two ways of provisioning persistent volumes.</p><ul><li><em>Static</em><li><em>Dynamic</em></ul><h3 id="static-storage-provisioning">Static Storage Provisioning</h3><p>Static storage provisioning creates persistent volumes manually for apps that require data persistence. In this approach, a cluster administrator needs to create PVs manually on the Kubernetes cluster.</p><p>For example, create PV and PVC manually for data persistence of the MySQL database server.</p><p>PersistentVolume:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolume</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pv-mysql-example</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">manual</span> <span class="c1"># Set storageclass name to "manual" or empty.</span>
  <span class="na">capacity</span><span class="pi">:</span>
    <span class="na">storage</span><span class="pi">:</span> <span class="s">8Gi</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">persistentVolumeReclaimPolicy</span><span class="pi">:</span> <span class="s">Retain</span>
  <span class="na">hostPath</span><span class="pi">:</span>
    <span class="na">path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/data/mysql"</span>
</pre></table></code></div></div><p>PersistentVolumeClaim:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-mysql-example</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">sandbox</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">manual</span> <span class="c1"># Set storageclass name to "manual" or empty.</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">8Gi</span>
</pre></table></code></div></div><p>MySQL Pod:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mysql-example</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">sandbox</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mysql-example</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:latest</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mysql-tcp</span>
          <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">containerPort</span><span class="pi">:</span> <span class="m">3306</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/data/mysql"</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">vol-mysql-data</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">vol-mysql-data</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">pvc-mysql-example</span>
<span class="nn">...</span>
</pre></table></code></div></div><p>You can use the default <code class="language-plaintext highlighter-rouge">manual</code> class name that does not require any storage provisioner. It can be used to create PersistentVolume, PVs manually. See tutorial, <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/">https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage</a></p><p>Kubernetes supports <code class="language-plaintext highlighter-rouge">hostPath</code> persistent volume for development and local testing. In this approach, you need to create PV and PVC manually, and create volume mounts using PVC <code class="language-plaintext highlighter-rouge">pvc-mysql-example</code> in the MySQL Pod. And then MySQL data will be stored in the <code class="language-plaintext highlighter-rouge">/data/mysql</code> path on the local Kubernetes node.</p><h3 id="dynamic-storage-provisioning">Dynamic Storage Provisioning</h3><p>Dynamic storage provisioning enables and allows to create persistent volumes on-demand or dynamically on the Kubernetes cluster based on the <em>StorageClass</em> API object. Basically, <em>StorageClass</em> defines which storage provisioner should be used when creating persistent volumes on Kubernetes.</p><blockquote><p>📝 But, please note that you need to deploy the provisioner on the Kubernetes cluster and we will explore how to setup in the next section.</p></blockquote><p>In this approach, you can use any StorageClass when you configure PersistentVolumeClaim (PVC), and then it will automatically create PersistentVolume (PV) on the Kubernetes cluster.</p><p>For example,</p><p>PersistentVolumeClaim (PVC) with local-path storageclass:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-mysql-example</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">sandbox</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">local-path</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">8Gi</span>
</pre></table></code></div></div><p>MySQL Pod:</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">mysql-example</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">sandbox</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mysql-example</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:latest</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mysql-tcp</span>
          <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
          <span class="na">containerPort</span><span class="pi">:</span> <span class="m">3306</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s2">"</span><span class="s">/data/mysql"</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">vol-mysql-data</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">vol-mysql-data</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">pvc-mysql-example</span>
<span class="nn">...</span>
</pre></table></code></div></div><p>In the above example, it creates volume mounts using PVC <code class="language-plaintext highlighter-rouge">pvc-mysql-example</code> in the MySQL Pod. And then MySQL data will be stored in the path specified by the provisioner on the Kubernetes node.</p><p>It depends on the provisioner you deployed and the provisioner’s mount path configuration. For example, the default path of Rancher’s local-path provisioner on the Kubernetes node is <code class="language-plaintext highlighter-rouge">/var/lib/rancher/k3s/storage/</code>.</p><p>In the next section, we will learn how to setup the <em>local-path</em> and <em>NFS</em> provisioners on the Kubernetes cluster.</p><h2 id="setting-up-local-path-provisioner">Setting Up Local Path Provisioner</h2><p>Local Path Provisioner provides the ability to create the local persistent storage on-demand or dynamically in each Kubernetes node. Basically, it uses <a href="https://kubernetes.io/docs/concepts/storage/volumes/#hostpath">hostPath</a> or <a href="https://kubernetes.io/docs/concepts/storage/volumes/#local">local</a> to create and deploy local persistent volumes on the Kubernetes node automatically. It’s simpler to provision local persistent volumes.</p><p>Documentation is available at <a href="https://github.com/rancher/local-path-provisioner/blob/master/README.md">https://github.com/rancher/local-path-provisioner/blob/master/README.md</a></p><h3 id="installation">Installation</h3><p>In this article, we will use Rancher’s local-path provisioner on a self-managed Kubernetes cluster.</p><p>Local Path Provisioner: <a href="https://github.com/rancher/local-path-provisioner">https://github.com/rancher/local-path-provisioner</a></p><p>Install with kubectl,</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/rancher/local-path-provisioner/v0.0.30/deploy/local-path-storage.yaml
</pre></table></code></div></div><p>The provisioner will be installed in the <code class="language-plaintext highlighter-rouge">local-path-storage</code> namespace by default. After installation, check the provisioner pod and storageclass.</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl get pods <span class="nt">--namespace</span> local-path-storage
NAME                                                  READY   STATUS      RESTARTS         AGE
local-path-provisioner-5cffd47f7-42nbw                1/1     Running     0                5d20h
</pre></table></code></div></div><blockquote><p>📝 The StorageClass resource is a cluster-wide resource and has no namespace scope. You just need to run the <code class="language-plaintext highlighter-rouge">kubectl get storageclass</code> command.</p></blockquote><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl get storageclass
NAME                   PROVISIONER                    RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
local-path             rancher.io/local-path          Delete          WaitForFirstConsumer   <span class="nb">false                  </span>5d20h
</pre></table></code></div></div><h3 id="using-local-path-provisioner">Using Local Path Provisioner</h3><p>In this section, we will test creating a <em>PersistentVolume</em> for a <em>Pod</em> automatically using PVC with the <em>local-path</em> storageclass. I will demonstrate it using the Busybox container image.</p><p>Create a YAML named <code class="language-plaintext highlighter-rouge">local-storage-busybox.yaml</code>.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-local-example</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">sandbox</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">local-path</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">8Gi</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">local-storage-example</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">sandbox</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">busybox</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">busybox:latest</span>
      <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
      <span class="na">command</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">sh</span>
        <span class="pi">-</span> <span class="s1">'</span><span class="s">-c'</span>
        <span class="pi">-</span> <span class="pi">&gt;-</span>
          <span class="s">while true; do</span>
            <span class="s">echo "$(date) [$(hostname)] Hello from Local Persistent Volume." &gt;&gt; /data/local/greet.txt</span>
            <span class="s">sleep $((RANDOM % 5 + 300))</span>
          <span class="s">done</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">vol-pvc-local</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/data/local</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">vol-pvc-local</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">pvc-local-example</span>
</pre></table></code></div></div><p>Then, install with the kubectl command-line tool like this:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> local-storage-busybox.yaml
</pre></table></code></div></div><h3 id="how-it-works">How it Works</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/featured-images/img_k8s_storage_local.png" alt="k8s-local-path-storage" /></p><h4 id="persistentvolumeclaim-pvc">PersistentVolumeClaim (PVC)</h4><p>In the <strong>PersistentVolumeClaim</strong>, configured with the <em>local-path</em> storageclass, access mode is set to <em>ReadWriteOnce</em> and 8Gi storage is requested. But, please NOTE that <em>local</em> or <em>hostPath</em> only supports <em>ReadWriteOnce</em> access mode.</p><p>For the detailed information about <strong>Access Modes</strong>, please see the <a href="#how-it-works-1">Access Modes in NFS storage section</a>.</p><p>Then, it will be provisioned a PV (PersistentVolume) automatically by <strong>Local Path Provisioner</strong> via <em>StorageClass</em> because we’ve installed it and configured PVC (PersistentVolumeClaim) using the <em>local-path</em> storage class. So, it’s called dynamic storage provisioning and we only need to configure PVC (PersistentVolumeClaim) with storage class.</p><blockquote><p>📝 The PV resource is a cluster-wide resource and has no namespace scope. You just need to run the <code class="language-plaintext highlighter-rouge">kubectl get pv</code> command.</p></blockquote><p>Check PV with the kubectl command-line tool like this,</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl get pv
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                        STORAGECLASS       VOLUMEATTRIBUTESCLASS   REASON   AGE
pvc-7e22e4b8-09d8-4553-88fc-1aefeb7c1ac3   8Gi        RWO            Delete           Bound    sandbox/pvc-local-example    local-path         &lt;<span class="nb">unset</span><span class="o">&gt;</span>                          54m
</pre></table></code></div></div><hr /><h4 id="busybox-pod-workload">Busybox Pod (Workload)</h4><p>In the <strong>Pod</strong>, created a volume mount path, <code class="language-plaintext highlighter-rouge">/data/local</code> using the PersistentVolumeClaim (PVC) named <em>pvc-local-example</em> with the Busybox container image. Basically, Pod’s command or script creates a file named <em>greet.txt</em>, writes date and hostname data to this file every 5m.</p><p>You can check the data by executing into the Pod shell.</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> local-storage-example <span class="nt">--namespace</span> sandbox <span class="nt">--</span> sh
<span class="nv">$ </span><span class="nb">cd</span> /data/local/
<span class="nv">$ </span><span class="nb">cat </span>greet.txt
</pre></table></code></div></div><p>Output:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Sun Jan 19 05:31:11 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
Sun Jan 19 05:36:14 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
Sun Jan 19 05:41:16 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
Sun Jan 19 05:46:16 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
Sun Jan 19 05:51:18 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
</pre></table></code></div></div><h4 id="worker-node">Worker Node</h4><p>The actual data <em>greet.txt</em> file will be stored on the worker node’s local-path provisioner mount path and the mount path on the worker node depends on the provisioner. For example, Rancher’s local-path provisioner mount path is <code class="language-plaintext highlighter-rouge">/var/lib/rancher/k3s/storage/</code> by default.</p><p>Then, check if the data <em>greet.txt</em> file is stored on the worker node correctly or not.</p><ul><li><p>Log in to the worker node with SSH.</p><li><p>Then, go to the <code class="language-plaintext highlighter-rouge">/var/lib/rancher/k3s/storage/</code> path and check the data by running the following commands.</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>root@k8s-worker:/var/lib/rancher# <span class="nb">cd</span> /var/lib/rancher/k3s/storage
root@k8s-worker:/var/lib/rancher/k3s/storage# <span class="nb">ls</span> <span class="nt">-l</span> pvc-7e22e4b8-09d8-4553-88fc-1aefeb7c1ac3_sandbox_pvc-local-example
total 52
<span class="nt">-rw-r--r--</span> 1 root root 45657 Jan 21 00:28 greet.txt
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd </span>pvc-7e22e4b8-09d8-4553-88fc-1aefeb7c1ac3_sandbox_pvc-local-example
<span class="nv">$ </span><span class="nb">cat </span>greet.txt
Sun Jan 19 05:31:11 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
Sun Jan 19 05:36:14 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
Sun Jan 19 05:41:16 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
Sun Jan 19 05:46:16 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
Sun Jan 19 05:51:18 UTC 2025 <span class="o">[</span>local-storage-example] Hello from Local Persistent Volume.
</pre></table></code></div></div></ul><p>The data directory name or persistent volume data on the worker node is provisioned in the following format.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{pv_name}-{namespace}{pvc_name}
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>pvc-7e22e4b8-09d8-4553-88fc-1aefeb7c1ac3_sandbox_pvc-local-example
</pre></table></code></div></div><h2 id="setting-up-nfs-provisioner">Setting up NFS Provisioner</h2><p>NFS (Network File System) is a distributed file system protocol that allows you to store and mount data on the remote server, also known as the NFS server. That means a client user can access data over a network and server-client way to manage data storage.</p><p>In Kubernetes, we will use <a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner">NFS Subdir External Provisioner</a> for provisioning persistent volumes on the NFS server. Basically, <em>NFS subdir external provisioner</em>, is a dynamic provisioner that uses the already configured NFS server to provision and create Kubernetes persistent volumes automatically on its NFS server using the PVC (PersistentVolumeClaim) and storage class.</p><p>Documentation at available at <a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/blob/master/README.md">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner/blob/master/README.md</a></p><p>Before you deploy the NFS provisioner on Kubernetes, make sure you install both the NFS server and client tool.</p><h3 id="setup-nfs-server">Setup NFS Server</h3><p>Install the NFS server package. It depends on your Linux distribution. In this article, we will install it on Ubuntu Linux.</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> nfs-server
</pre></table></code></div></div><p>Configure the NFS server <code class="language-plaintext highlighter-rouge">/etc/exports</code> configuration for access control list for filesystems that may be exported to NFS clients.</p><blockquote><p>📝 IPv4 address or hostname is your NFS clients IP addresses.</p></blockquote><p>Format,</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>/mount/path          ip_addr_or_hostname<span class="o">(</span>rw,sync,no_subtree_check,no_root_squash<span class="o">)</span>
</pre></table></code></div></div><p>For example,</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c"># /etc/exports: the access control list for filesystems which may be exported</span>
<span class="c">#               to NFS clients.  See exports(5).</span>
<span class="c">#</span>
<span class="c"># Example for NFSv2 and NFSv3:</span>
<span class="c"># /srv/homes       hostname1(rw,sync,no_subtree_check) hostname2(ro,sync,no_subtree_check)</span>
<span class="c">#</span>
<span class="c"># Example for NFSv4:</span>
<span class="c"># /srv/nfs4        gss/krb5i(rw,sync,fsid=0,crossmnt,no_subtree_check)</span>
<span class="c"># /srv/nfs4/homes  gss/krb5i(rw,sync,no_subtree_check)</span>
<span class="c">#</span>
/data/nfs          172.16.x.1<span class="o">(</span>rw,sync,no_subtree_check,no_root_squash<span class="o">)</span>
/data/nfs          172.16.x.2<span class="o">(</span>rw,sync,no_subtree_check,no_root_squash<span class="o">)</span>
/data/nfs          172.16.x.3<span class="o">(</span>rw,sync,no_subtree_check,no_root_squash<span class="o">)</span>
</pre></table></code></div></div><h3 id="install-nfs-client-on-worker-nodes">Install NFS Client on Worker Nodes</h3><p>Before you setup NFS storage provisioner, make sure you install the NFS client tool on the Kubernetes Worker nodes.</p><p>On Debian-based Linux systems,</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> nfs-common
</pre></table></code></div></div><p>On RHEL-based Linux systems, for example: Fedora Linux,</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>dnf <span class="nb">install</span> <span class="nt">-y</span> nfs-utils
</pre></table></code></div></div><h3 id="install-nfs-subdir-external-provisioner">Install NFS Subdir External Provisioner</h3><p>In this section, we will install the <em>NFS subdir external provisioner</em> with the Helm package manager.</p><p>Helm Repo URL: <a href="https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner">https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner</a></p><p>Add a Helm repository,</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner
</pre></table></code></div></div><p>Install the <em>NFS subdir external provisioner</em> with Helm like this,</p><p>Format:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>helm <span class="nb">install </span>nfs-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner <span class="se">\</span>
    <span class="nt">--create-namespace</span> <span class="se">\</span>
    <span class="nt">--namespace</span> nfs-provisioner <span class="se">\</span>
    <span class="nt">--set</span> nfs.server<span class="o">=</span>ip_addr_or_hostname <span class="se">\</span>
    <span class="nt">--set</span> nfs.path<span class="o">=</span>/exported/path
</pre></table></code></div></div><p>Example:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>helm <span class="nb">install </span>nfs-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner <span class="se">\</span>
    <span class="nt">--create-namespace</span> <span class="se">\</span>
    <span class="nt">--namespace</span> nfs-provisioner <span class="se">\</span>
    <span class="nt">--set</span> nfs.server<span class="o">=</span>127.0.0.1 <span class="se">\</span>
    <span class="nt">--set</span> nfs.path<span class="o">=</span>/data/nfs
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">nfs.server=127.0.0.1</code> Replace the IP address with your NFS IP address.</p><p><code class="language-plaintext highlighter-rouge">nfs.path=/data/nfs</code> Replace the mount path with your exported path or mount path on the NFS server.</p><p>The <em>NFS subdir external provisioner</em> will be installed in the <em>nfs-provisioner</em> namespace. After installation, check the NFS provisioner’s workload (Pods) and StorageClass with the kubectl command-line tool.</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl get pods <span class="nt">--namespace</span> nfs-provisioner
NAME                                                              READY   STATUS    RESTARTS       AGE
nfs-provisioner-infra-nfs-subdir-external-provisioner-665fhd2wn   1/1     Running   0              5d20h
</pre></table></code></div></div><blockquote><p>📝 The StorageClass resource is a cluster-wide resource and has no namespace scope. You just need to run the <code class="language-plaintext highlighter-rouge">kubectl get storageclass</code> command.</p></blockquote><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl get storageclass
NAME                        PROVISIONER                                                     RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE
nfs-client                  cluster.local/nfs-provisioner-nfs-subdir-external-provisioner   Delete          Immediate              <span class="nb">true                   </span>5d20h
</pre></table></code></div></div><h3 id="using-the-nfs-subdir-external-provisioner">Using the NFS Subdir External Provisioner</h3><p>In this section, we will test creating and provisioning a <em>PersistentVolume (PV)</em> for a <em>Pod</em> automatically using <em>PersistentVolumeClaim (PVC)</em> with the <code class="language-plaintext highlighter-rouge">nfs-client</code> storage class. I will demonstrate it using the Busybox container image.</p><p>Create a YAML file named <code class="language-plaintext highlighter-rouge">nfs-storage-busybox.yaml</code> that includes PersistentVolumeClaim (PVC) and Pod resources.</p><div class="language-yaml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">pvc-nfs-example</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">sandbox</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteMany</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">nfs-client</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">8Gi</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-storage-example</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">sandbox</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">busybox</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">busybox:latest</span>
      <span class="na">imagePullPolicy</span><span class="pi">:</span> <span class="s">IfNotPresent</span>
      <span class="na">command</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">sh</span>
        <span class="pi">-</span> <span class="s">-c</span>
        <span class="pi">-</span> <span class="pi">&gt;-</span>
          <span class="s">while true; do</span>
            <span class="s">echo "$(date) [$(hostname)] Hello from NFS Persistent Volume." &gt;&gt; /app/data/greet.txt</span>
            <span class="s">sleep $((RANDOM % 5 + 300))</span>
          <span class="s">done</span>
      <span class="na">volumeMounts</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">vol-pvc-nfs</span>
          <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/app/data</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">vol-pvc-nfs</span>
      <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
        <span class="na">claimName</span><span class="pi">:</span> <span class="s">pvc-nfs-example</span>
</pre></table></code></div></div><p>Then, install with the <code class="language-plaintext highlighter-rouge">kubectl</code> command-line tool like this,</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> nfs-storage-busybox.yaml
</pre></table></code></div></div><h3 id="how-it-works-1">How it Works</h3><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/images/featured-images/img_k8s_storage_nfs.png" alt="k8s-nfs-storage" /></p><h4 id="persistentvolumeclaim-pvc-1">PersistentVolumeClaim (PVC)</h4><p>In the <strong>PersistentVolumeClaim</strong>, configured with the <code class="language-plaintext highlighter-rouge">nfs-client</code> storage class, access mode is set to <em>ReadWriteMany</em> and 8Gi storage is requested.</p><p><code class="language-plaintext highlighter-rouge">spec.accessModes</code> Set accessModes to <code class="language-plaintext highlighter-rouge">ReadWriteMany</code>. Basically, an access mode defines how a PV (PersistentVolume) can be accessed by Pods. That specifies <em>Who</em> can mount the volume (one or multi Kubernetes nodes) and <em>How</em> the volume can be accessed (read-only or read-write).</p><p>Documentation is also available at <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes">https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes</a></p><p>The available access modes are <em>ReadWriteOnce</em>, <em>ReadOnlyMany</em>, <em>ReadWriteMany</em> and <em>ReadWriteOncePod</em>. <em>But it depends on storage providers, and we need to check which access mode is supported.</em></p><ul><li><p><strong>ReadWriteOnce (RWO)</strong>: The persistent volume can be mounted as read-write by a single node at a time.</p><li><p><strong>ReadOnlyMany (ROX)</strong>: The persistent volume can be mounted as read-only by multi nodes simultaneously.</p><li><p><strong>ReadWriteMany (RWX)</strong>: The persistent volume can be mounted as read-write by multi nodes at the same time.</p><li><p><strong>ReadWriteOncePod (RWOP) - Kubernetes v1.22+</strong>: The persistent volume can be mounted by only one <em>Pod</em> at a time.</p></ul><div class="table-wrapper"><table><thead><tr><th>Access Mode<th>Multi Nodes<th>Read-Write<th>Common Storage Types<tbody><tr><td>ReadWriteOnce (RWO)<td>❌ No<td>✅ Yes<td>e.g; Rancher’s local-path, AWS EBS<tr><td>ReadOnlyMany (ROX)<td>✅ Yes<td>❌ No<td>e.g; NFS, CephFS<tr><td>ReadWriteMany (RWX)<td>✅ Yes<td>✅ Yes<td>e.g; Azure Files, CephFS, NFS, Longhorn, OpenEBS and etc…<tr><td>ReadWriteOncePod (RWOP)<td>❌ No (Only one Pod)<td>✅ Yes<td>e.g; Block storage like RWO but single Pod restriction</table></div><blockquote><p>📝 The <em>ReadWriteOncePod</em> access mode is only supported for CSI volumes and Kubernetes version 1.22 and up.</p></blockquote><p><code class="language-plaintext highlighter-rouge">spec.storageClassName</code> Set storageClassName to <em>nfs-client</em>. It depends on what storage class you want to use.</p><p><code class="language-plaintext highlighter-rouge">spec.resources.requests.storage</code> Set storage size that PVC (PersistentVolumeClaim) requests storage from a PV (PersistentVolume).</p><p>After deploying the above PVC (PersistentVolumeClaim) named <code class="language-plaintext highlighter-rouge">pvc-nfs-example</code>, it will be provisioned a PV (PersistentVolume) by the <em>NFS subdir external provisioner</em> using the <code class="language-plaintext highlighter-rouge">nfs-client</code> storage class.</p><p>Then, check PV (PersistentVolume) resource with the kubectl command-line tool,</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl get pv
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                     STORAGECLASS       VOLUMEATTRIBUTESCLASS   REASON   AGE
pvc-edf39de5-42e2-453a-a23f-c4f5f58cf69a   8Gi        RWX            Delete           Bound    sandbox/pvc-nfs-example   nfs-client         &lt;<span class="nb">unset</span><span class="o">&gt;</span>                          6h46m
</pre></table></code></div></div><hr /><h4 id="busybox-pod-workload-1">Busybox Pod (Workload)</h4><p>In the <strong>Pod</strong>, created a volume mount path, <code class="language-plaintext highlighter-rouge">/app/data</code> using the PersistentVolumeClaim (PVC) named <em>pvc-nfs-example</em> with the Busybox container image. Basically, Pod’s command or script creates a file named <em>greet.txt</em>, writes <em>date and hostname</em> data to this file every 5m.</p><p>Then, you can check the data by executing into the Pod shell.</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">$ </span>kubectl <span class="nb">exec</span> <span class="nt">-it</span> nfs-storage-example <span class="nt">--namespace</span> sandbox <span class="nt">--</span> sh
<span class="nv">$ </span><span class="nb">cd</span> /app/data
<span class="nv">$ </span><span class="nb">cat </span>greet.txt
</pre></table></code></div></div><p>Output:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Tue Jan 28 23:10:38 UTC 2025 [nfs-storage-example] Hello from NFS Persistent Volume.
Tue Jan 28 23:15:42 UTC 2025 [nfs-storage-example] Hello from NFS Persistent Volume.
Tue Jan 28 23:20:44 UTC 2025 [nfs-storage-example] Hello from NFS Persistent Volume.
Tue Jan 28 23:25:47 UTC 2025 [nfs-storage-example] Hello from NFS Persistent Volume.
Tue Jan 28 23:30:48 UTC 2025 [nfs-storage-example] Hello from NFS Persistent Volume.
</pre></table></code></div></div><hr /><h4 id="nfs-server">NFS Server</h4><p>The actual data <em>greet.txt</em> file will be stored on the NFS server’s mount path, <code class="language-plaintext highlighter-rouge">/data/nfs/</code> and the mount path is specified when you set up the NFS server and the NFS subdir external provisioner.</p><p>Then, check if the data <em>greet.txt</em> file is stored on the NFS server correctly or not.</p><ul><li><p>Log in to the NFS server with SSH.</p><li><p>Then, go to the NFS mount path <code class="language-plaintext highlighter-rouge">/data/nfs/</code> and check the data by running the <code class="language-plaintext highlighter-rouge">ls</code> and <code class="language-plaintext highlighter-rouge">cat</code> commands.</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>zawzaw@nfs-dev-server:~<span class="nv">$ </span><span class="nb">cd</span> /data/nfs/
zawzaw@nfs-dev-server:/data/nfs<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> sandbox-pvc-nfs-example-pvc-edf39de5-42e2-453a-a23f-c4f5f58cf69a/
total 12
<span class="nt">-rw-r--r--</span> 1 root root 10795 Jan 29 16:14 greet.txt
</pre></table></code></div></div><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">cd </span>sandbox-pvc-nfs-example-pvc-edf39de5-42e2-453a-a23f-c4f5f58cf69a
<span class="nv">$ </span><span class="nb">cat </span>greet.txt
Tue Jan 28 23:10:38 UTC 2025 <span class="o">[</span>nfs-storage-example] Hello from NFS Persistent Volume.
Tue Jan 28 23:15:42 UTC 2025 <span class="o">[</span>nfs-storage-example] Hello from NFS Persistent Volume.
Tue Jan 28 23:20:44 UTC 2025 <span class="o">[</span>nfs-storage-example] Hello from NFS Persistent Volume.
Tue Jan 28 23:25:47 UTC 2025 <span class="o">[</span>nfs-storage-example] Hello from NFS Persistent Volume.
Tue Jan 28 23:30:48 UTC 2025 <span class="o">[</span>nfs-storage-example] Hello from NFS Persistent Volume.
</pre></table></code></div></div></ul><p>The data directory or persistent volume data on the NFS server is provisioned as the following format.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>{namespace}-{pvc_name}-{pv_name}
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>sandbox-pvc-nfs-example-pvc-edf39de5-42e2-453a-a23f-c4f5f58cf69a
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/storage/" class="post-tag no-text-decoration" >storage</a> <a href="/tags/provisioning/" class="post-tag no-text-decoration" >provisioning</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=A Hands-on Practical Guide to K8s Persistent Storage - Zaw Zaw&url=https://zawzaw.blog/posts/guide-k8s-persistent-storage/" data-toggle="tooltip" data-placement="top" title="X (Twitter)" target="_blank" rel="noopener" aria-label="X (Twitter)"> <i class="fa-fw fab fa-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=A Hands-on Practical Guide to K8s Persistent Storage - Zaw Zaw&u=https://zawzaw.blog/posts/guide-k8s-persistent-storage/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://zawzaw.blog/posts/guide-k8s-persistent-storage/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2" style="font-size: large;">Table of Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Related Posts</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/write-k8s-helm-chart/"><div class="card-body"> <span class="timeago small" > Feb 14, 2022 <i class="unloaded">2022-02-14T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a Kubernetes Helm Chart from Scratch</h3><div class="text-muted small"><p> In this blog post, I will share about writing Kubernetes Helm chart, YAML-based Helm template language, Helm chart development tips and focus on how to write a simple Helm Chart step by step for an...</p></div></div></a></div><div class="card"> <a href="/posts/automated-k3s-cluster-upgrades/"><div class="card-body"> <span class="timeago small" > Feb 25, 2024 <i class="unloaded">2024-02-25T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Bootstrapping a K3s Cluster and Configuring its Automated Upgrades</h3><div class="text-muted small"><p> This article focuses on how to setup and bootstrap the multi-node K3s cluster and how to configure automated upgrading of the K3s Kubernetes cluster. This covers both how to setup a multi-node K3s ...</p></div></div></a></div><div class="card"> <a href="/posts/configure-k8s-auth-rbac/"><div class="card-body"> <span class="timeago small" > Dec 5, 2024 <i class="unloaded">2024-12-05T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Configuring RBAC Role Bindings for a User on Kubernetes</h3><div class="text-muted small"><p> This article focuses on how to create a user and configure cluster roles and role bindings for that user using Kubernetes built-in RBAC authorization features. Basically, in Kubernetes, we can use ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/configure-k8s-auth-rbac/" class="btn btn-outline-primary" prompt="Older"><p>Configuring RBAC Role Bindings for a User on Kubernetes</p></a> <a href="/posts/deep-dive-single-host-container-net/" class="btn btn-outline-primary" prompt="Newer"><p>Containers from Scratch: Deep Dive into Single-Host Container Networking</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025, <a href="https://github.com/zawzaww">Zaw Zaw</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) by the author.">Licensed under CC BY 4.0.</span></p></div><div class="footer-right"><p class="mb-0"> <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">CHIRPY Theme</a> &mdash; <a href="https://jekyllrb.com" target="_blank" rel="noopener"> Powered byJekyll</a></p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/aosp/">aosp</a> <a class="post-tag" href="/tags/build/">build</a> <a class="post-tag" href="/tags/containerization/">containerization</a> <a class="post-tag" href="/tags/containers/">containers</a> <a class="post-tag" href="/tags/networking/">networking</a> <a class="post-tag" href="/tags/asia/">asia</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://zawzaw.blog{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
